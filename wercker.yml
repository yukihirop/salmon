box: ruby:2.4.0

services:
  - id: postgres
    env:
      POSTGRES_ENV_PG_MAJOR: 9.6

build:
  steps:
    - bundle-install

backend-spec:
  steps:
    - bundle-install

    - rails-database-yml:
      service: postgresql-docker

    - script:
      name: Prepare database
      code: RAILS_ENV=test bin/rake db:schema:load

    - script:
      name: Run RSpec
      code: bundle exec rspec spec

backend-request-spec:
  steps:
    - bundle-install

    - rails-database-yml:
      service: postgresql-docker

    - script:
      name: Prepare database
      code: RAILS_ENV=test bin/rake db:schema:load

    - script:
      name: Run request spec
      code: bundle exec rspec spec/requests


backend-model-spec:
  steps:
    - bundle-install

    - rails-database-yml:
      service: postgresql-docker

    - script:
      name: Prepare database
      code: RAILS_ENV=test bin/rake db:schema:load

    - script:
      name: Run model spec
      code: bundle exec rspec spec/models

backend-routing-spec:
  steps:
    - bundle-install

    - rails-database-yml:
      service: postgresql-docker

    - script:
      name: Prepare database
      code: RAILS_ENV=test bin/rake db:schema:load

    - script:
      name: Run model spec
      code: bundle exec rspec spec/routing
